{% extends 'base.html' %}
{% block content %}
<div class="profile-container">
    <div class="profile-card">
        <h1>Welcome {{ user.username }}</h1>
        <div class="section">
            <h3>Your Friends</h3>
            <ul>
                {% for friend in user.friends %}
                    <li>{{ friend.username }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="section">
            <h3>Add a Friend</h3>
            <form method="POST" action="/add_friend" class="form-inline" id="add-friend-form">
                <input type="text" name="username" id="friend-username" placeholder="Friend's Username or Invite Link" required>
                <button type="submit" class="btn-primary">Add Friend</button>
            </form>
        </div>
        <div class="section">
            <h3>Invite Friends</h3>
            <p>Share this link to invite friends:</p>
            <!-- Invite link input field -->
            <input type="text" id="invite-link" value="{{ invite_link }}" readonly class="readonly-input">
            <!-- Copy button -->
            <button id="copy-button" data-clipboard-target="#invite-link">Copy Invite Link</button>
        </div>
    </div>
</div>

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
{% endblock %}

{% block scripts %}
    <!-- Clipboard.js script for copying to clipboard -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
    
    <script>
        // Initialize Clipboard.js to handle copy button
        var clipboard = new ClipboardJS('#copy-button');

        clipboard.on('success', function(e) {
            alert('Invite link copied to clipboard!');
        });

        clipboard.on('error', function(e) {
            alert('Failed to copy invite link. Please try again!');
        });

        // Handle pasting invite link in Add Friend input
        document.getElementById('friend-username').addEventListener('input', function() {
            const inviteLink = this.value;
            // Check if the input is a valid invite link
            const regex = /\/register\/([a-zA-Z0-9_]+)/;
            const match = inviteLink.match(regex);
            if (match && match[1]) {
                // Extract username from invite link
                this.value = match[1];  // Set the username in the input field
            }
        });
    </script>
{% endblock %}
{% endblock %}
